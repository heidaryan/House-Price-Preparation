
---
title: "House price"
author: "ForozanHeidaryan"
date: "2022-12-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Understanding the Business Question

Price Recommendation for  house
Data inspection

# Dataset Description
## File descriptions


data_description.txt - full description of each column, originally prepared by Dean De Cock

but lightly edited to match the column names used here

sample_submission.csv - a benchmark submission from a linear regression on year and month of 
sale, lot square footage, and number of bedrooms

Data fields

Here's a brief version of what you'll find in the data description file.

SalePrice :   the property's sale price in dollars. This is the target variable that you're 

trying to predict.

MSSubClass:   The building class

MSZoning:     The general zoning classification

LotFrontage:  Linear feet of street connected to property

LotArea:      Lot size in square feet

Street:       Type of road access

Alley:        Type of alley access

LotShape:     General shape of property

LandContour:  Flatness of the property

Utilities:    Type of utilities available

LotConfig:    Lot configuration

LandSlope:    Slope of property

Neighborhood: Physical locations within Ames city limits

Condition1:   Proximity to main road or railroad

Condition2:   Proximity to main road or railroad (if a second is present)

BldgType:     Type of dwelling

HouseStyle:   Style of dwelling

OverallQual:  Overall material and finish quality

OverallCond:  Overall condition rating

YearBuilt:    Original construction date

YearRemodAdd: Remodel date

RoofStyle:    Type of roof

RoofMatl:     Roof material

Exterior1st:  Exterior covering on house

Exterior2nd:  Exterior covering on house (if more than one material)

MasVnrType:   Masonry veneer type

MasVnrArea:   Masonry veneer area in square feet

ExterQual:    Exterior material quality

ExterCond:    Present condition of the material on the exterior

Foundation:   Type of foundation

BsmtQual:     Height of the basement

BsmtCond:     General condition of the basement

BsmtExposure: Walkout or garden level basement walls

BsmtFinType1: Quality of basement finished area

BsmtFinSF1:   Type 1 finished square feet

BsmtFinType2: Quality of second finished area (if present)

BsmtFinSF2:   Type 2 finished square feet

BsmtUnfSF:    Unfinished square feet of basement area

TotalBsmtSF:  Total square feet of basement area

Heating:      Type of heating

HeatingQC:    Heating quality and condition

CentralAir:   Central air conditioning

Electrical:   Electrical system

1stFlrSF:     First Floor square feet

2ndFlrSF:     Second floor square feet

LowQualFinSF: Low quality finished square feet (all floors)

GrLivArea:    Above grade (ground) living area square feet

BsmtFullBath: Basement full bathrooms

BsmtHalfBath: Basement half bathrooms

FullBath:     Full bathrooms above grade

HalfBath:     Half baths above grade

Bedroom:      Number of bedrooms above basement level

Kitchen:      Number of kitchens

KitchenQual:  Kitchen quality

TotRmsAbvGrd: Total rooms above grade (does not include bathrooms)

Functional:   Home functionality rating

Fireplaces:   Number of fireplaces

FireplaceQu:  Fireplace quality

GarageType:   Garage location

GarageYrBlt:  Year garage was built

GarageFinish: Interior finish of the garage

GarageCars:   Size of garage in car capacity

GarageArea:   Size of garage in square feet

GarageQual:   Garage quality

GarageCond:   Garage condition

PavedDrive:   Paved driveway

WoodDeckSF:   Wood deck area in square feet

OpenPorchSF:  Open porch area in square feet

EnclosedPorch:Enclosed porch area in square feet

3SsnPorch:    Three season porch area in square feet

ScreenPorch:  Screen porch area in square feet

PoolArea:     Pool area in square feet

PoolQC:       Pool quality

Fence:        Fence quality

MiscFeature:  Miscellaneous feature not covered in other categories

MiscVal:      $Value of miscellaneous feature

MoSold:       Month Sold

YrSold:       Year Sold

SaleType:     Type of sale

SaleCondition:Condition of sale

### read data from file 
```{r}
train <- read.csv("train.csv" , header = TRUE )
```

A summary of the data

```{r}
dim(train)
length(unique(train$Id))
summary(train)
```

Convert categorical variables to factor

```{r}
cat_var <- c("MSZoning" , "Street" , "Alley" ,"LotShape" , "LandContour", "Utilities" , "LotConfig" , "LandSlope" ,
             "Neighborhood" , "Condition1" , "Condition2" , "BldgType" ,
             "HouseStyle", "OverallQual", "OverallCond" , "RoofStyle" , "Exterior1st" , "Exterior2nd" , "MasVnrType",
             "ExterQual" ,"ExterCond" , "Foundation" , "BsmtQual" ,"BsmtCond" ,
             "BsmtExposure" ,"BsmtFinType1" ,"BsmtFinType2" , "Heating" , "HeatingQC" , "CentralAir" , "Electrical" , 
             "KitchenQual" , "Functional" , "Fireplaces" , "FireplaceQu" ,
             "GarageType" , "GarageFinish" , "GarageCars" , "GarageQual" ,"GarageCond" , "PavedDrive" , "PoolQC", 
             "Fence","RoofMatl" , 
             "MiscFeature" , "SaleType" , "SaleCondition")
```

```{r}
train[,cat_var]  <-  lapply(train[,cat_var] , factor)
knitr::kable(summary(train)) 
knitr::kable(str(train))
```

Identify missing data

```{r}
mv_summary2        <-  data.frame('variables name' = colnames(train))
mv_summary2$freq   <- apply(train , 2 , function(x)  sum(is.na(x)))
mv_summary2$pers   <- round(mv_summary2$freq / nrow(train) , 3) * 100
mv_summary2_1      <- as.data.frame(mv_summary2[mv_summary2$pers > 0 & mv_summary2$pers <10, ])
mv_summary2_2      <- as.data.frame(mv_summary2[mv_summary2$pers > 10 , ])
knitr::kable(mv_summary2_1)
knitr::kable(mv_summary2_2)
```

Removing columns that have more than 10% missing value

```{r}
t1 <-  train[,c("LotFrontage","Alley","FireplaceQu" ,"Fence" , 
                "MiscFeature" , "PoolQC")]
```

In my opinion, these columns have high missing values, so it causes problems in our modeling, so I preferred to remove them.

```{r}
train1 <- train[,-which(train %in% t1)]
dim(train1)
```

I also removed all the missing values in the rows. This is a good solution to get rid of the missing values

```{r}
train2 <- train1[apply(train1,1,function(x) any(is.na(x))) == F,]

```

For convenience, I divided the data into continuous and discrete parts

```{r}
cat <- train2[,c("MSZoning" , "Street" ,"LotShape" , "LandContour", "Utilities" , "LotConfig" , "LandSlope" ,
                 "Neighborhood" , "Condition1" , "Condition2" , "BldgType" ,
                 "HouseStyle", "OverallQual", "OverallCond" , "RoofStyle" , "Exterior1st" , "Exterior2nd" , 
                 "MasVnrType"    ,
                 "ExterQual" ,"ExterCond" , "Foundation" , "BsmtQual" ,"BsmtCond" ,
                 "BsmtExposure" ,"BsmtFinType1" ,"BsmtFinType2" , "Heating" , "HeatingQC" , "CentralAir" ,
                 "Electrical"  , 
                 "KitchenQual" , "Functional" , "GarageType" , "GarageFinish" , "GarageCars" , "GarageQual" ,
                 "GarageCond" , "PavedDrive" , 
                 "RoofMatl" , 
                 "SaleType" , "SaleCondition" ,"Fireplaces" )]
```

I prefer to convert the columns that contain the date field to age, this helps me more easily determine the relationship between the price and the life of the house.

```{r}

train3 <- train2[,-c(18,19,57,72)]
today <- as.Date("2022"  , format = "%Y")
```

```{r}
train3$ageBuilt <- as.Date(as.character(train2$YearBuilt) , format = "%Y")

train3$ageBuilt   <- as.numeric(today - train3$ageBuilt)

train3$ageBuilt<- round(train3$ageBuilt/365 )
summary(train3$ageBuilt)

train3$ageRemodAdd  <- as.Date(as.character(train2$YearRemodAdd), format = "%Y")

train3$ageRemodAdd <- as.numeric(today - train3$ageRemodAdd)

train3$ageRemodAdd <- round(train3$ageRemodAdd / 365 )

summary(train3$ageRemodAdd)

train3$GarageageBlt   <- as.Date(as.character(train2$GarageYrBlt),format = "%Y")
train3$GarageageBlt   <- as.numeric(today - train3$GarageageBlt)
train3$GarageageBlt   <-round(train3$GarageageBlt / 365 )

summary(train3$GarageageBlt)
#Regarding the sale date, it also helps me to better recognize the rise and fall of prices
train3$ageSold  <- as.Date(as.character(train2$YrSold) , format = "%Y")
train3$ageSold  <- as.numeric(today - train3$ageSold)
train3$ageSold  <- round(train3$ageSold / 365 )
summary(train3$ageSold)
```

Regarding the sale date, it also helps me to better recognize the rise and fall of prices

```{r}
par(mfrow = c(1,1))
hist(train$SalePrice , breaks = 50,probability = TRUE , col = "#4B0082")
lines(density(train$SalePrice) , col = "red")
```

```{r}
qqnorm(train$SalePrice , col = "#4B0082")
qqline(train$SalePrice , col = "red")
```

```{r}
par(mfrow = c(1,1))
boxplot(train$SalePrice)
```

```{r}
library("moments")

jarque.test(train$SalePrice)
#pvalue < 0   -> h0 regect
```

The graphs and statistical tests indicate that the response variable does not follow a normal distribution, which makes sense to me because a smaller percentage of people are very wealthy.I would like to approximate them to a normal distribution, this may help me
For this purpose, I use Box Cox conversion
```{r}

library("MASS")
box_result <- boxcox(train$SalePrice ~ 1 , lambda = seq(-5 , 5 , 0.1))
box_result <- data.frame(box_result)
lambda <- box_result[which(box_result$y == max(box_result$y)),] 
salPrice <- log(train$SalePrice)

```
It is clear that zero is inside this confidence interval
Therefore, I use logarithmic transformation

```{r}
hist(salPrice , breaks = 50 , probability = TRUE , col = "#4B0082")
lines(density(salPrice) , col = "red")
```

```{r}
qqnorm(salPrice , col = "#4B0082")
qqline(salPrice , col = "red")
```

```{r}
jarque.test(salPrice)
```

```{r}
anscombe.test(salPrice)
```

```{r}
par(mfrow = c(1,1))
boxplot(train3$SalePrice ,main = "plot respont", col = "#4B0082")
```
It seems that the data is far from the normal distribution

```{r}
tukey_u <- quantile(train3$SalePrice , probs = 0.75) + 1.5 * IQR(train3$SalePrice)

sum(train3$SalePrice > tukey_u)
```

The number of continuous data is very high, so I will convert them into two parts

```{r}
count <- train3[,-which(train3 %in% cat)]
cunt1 <- count[,c(1:17)]
cunt2 <- count[,c(18:33)]

cunt1 <- cunt1[,-1]
cunt1$SalePrice  <- cunt2$SalePrice
```

Histogram of continuous data

```{r}
par(mar = c(2,2,2,2))
par(mfrow = c(4,4))
for (i in 1:16 ) {
  hist(cunt1[,i] , xlab =   "" ,col = "#4B0082", main = paste("HIST COUNT 1" ,
                                                              names(cunt1[i])))
}
```

```{r}
par(mar = c(2,2,2,2))
par(mfrow = c(4,4))
for (i in 1:16) {
  hist(cunt2[,i] , xlab = "" , col = "#4B0082" , main = paste("HIST COUNT 2" , 
                                                              names(cunt1[i])))
}
```
Checking the correlation of continuous data with the response variable
```{r}
cros_tab <- round(cor(count),2)

library("corrplot")
par(mfrow = c(1,1))
corrplot(cros_tab)
```

```{r}
par(mar=c(2,2,2,2))
par(mfrow = c(4,4))
for (i in 1:16) {
  plot(cunt1[,i] , cunt2$SalePrice,xlab = "" , main = paste("plot" ,names(cunt1)[i] ))
}
```

```{r}
par(mar=c(2,2,2,2))
par(mfrow = c(4,4))
for (i in 1:16) {
  plot(cunt2[,i] , cunt2$SalePrice,xlab = "" , main = paste("plot" ,names(cunt2)[i] ))
}
```

I put the columns that contain discrete variables in one file

```{r}
categori <- train2[,which( train2 %in% cat)]
colnames(categori)
dim(categori)
```

Examining each variable with the response variable

```{r}
table(train3$MSZoning)
boxplot(SalePrice ~ MSZoning , data = train3 , col = "#4B0082" , border = "#7E3817")

```
   
   Residential Low Density seems to have the highest price

```{r}
table(train3$Street)
boxplot(SalePrice ~  Street , data = train3 , col = "#4B0082" , border = "#7E3817")
```
The type of Paved street has a great effect on the price. It seems that these houses are located in a more expensive area

```{r}
table(train3$LotShape)
boxplot(SalePrice ~ LotShape , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$LandContour)
boxplot(SalePrice ~ LandContour , data = train , col = "#4B0082" , border = "#7E3817") 
```

```{r}
table(train3$Utilities)
boxplot(SalePrice ~  Utilities , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$LotConfig)
boxplot(SalePrice ~  LotConfig , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$LandSlope)
boxplot(SalePrice ~  LandSlope , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Neighborhood)
boxplot(SalePrice ~ Neighborhood , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Condition1)
boxplot(SalePrice ~ Condition1 , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Condition2)
boxplot(SalePrice ~ Condition2 , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$BldgType)
boxplot(SalePrice ~ BldgType , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$HouseStyle)
boxplot(SalePrice ~ HouseStyle , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$OverallQual)
boxplot(SalePrice ~ OverallQual , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$OverallCond)
boxplot(SalePrice ~ OverallCond , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$RoofStyle)
boxplot(SalePrice ~ RoofStyle , data = train3 , col = "#4B0082"  , border = "#7E3817")
```

```{r}
table(train3$RoofMatl)
boxplot(SalePrice ~  RoofMatl , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Exterior1st)
boxplot(SalePrice ~ Exterior1st , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Exterior2nd)
boxplot(SalePrice ~ Exterior2nd , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$MasVnrType)
boxplot(SalePrice ~ MasVnrType , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$ExterQual)
boxplot(SalePrice ~ ExterQual ,data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$ExterCond)
boxplot(SalePrice ~ ExterCond , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Foundation)
boxplot(SalePrice ~ Foundation , data = train3 , col = "#4B0082" , border = "#7E3817") 
```

```{r}
table(train3$BsmtQual)
boxplot(SalePrice ~ BsmtQual , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$BsmtCond)
boxplot(SalePrice ~ BsmtCond , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$BsmtExposure)
boxplot(SalePrice ~ BsmtExposure , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$BsmtFinType1)
boxplot(SalePrice ~ BsmtFinType1 , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$BsmtFinType2)
boxplot(SalePrice ~ BsmtFinType2 , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Heating)
boxplot(SalePrice ~ Heating ,data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$HeatingQC)
boxplot(SalePrice ~ HeatingQC , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$CentralAir)
boxplot(SalePrice ~ CentralAir ,data = train3 , col = "#4B0082" , border = "#7E3817")

```

```{r}
table(train3$Electrical)
boxplot(SalePrice ~ Electrical , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$KitchenQual)
boxplot(SalePrice ~ KitchenQual , data = train3, col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Functional)
boxplot(SalePrice ~ Functional, data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$Fireplaces)
boxplot(SalePrice ~ Fireplaces , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$GarageType)
boxplot(SalePrice ~ GarageType , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$GarageFinish)
boxplot(SalePrice ~ GarageFinish , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$GarageCars)
boxplot(SalePrice ~ GarageCars , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$GarageCond)
boxplot(SalePrice ~ GarageCond , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$PavedDrive)
boxplot(SalePrice ~ PavedDrive , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$SaleType)
boxplot(SalePrice ~ SaleType , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
table(train3$SaleCondition)
boxplot(SalePrice ~ SaleCondition , data = train3 , col = "#4B0082" , border = "#7E3817")
```

```{r}
m1 <- lm(SalePrice ~ . ,data = train3 )

summary(m1)
```

```{r}
hist(m1$residuals , probability = TRUE , breaks = 35 ,col = "#4B0082" , border = "#7E3817" )
lines(density(m1$residuals) , col = "red")
```

```{r}
qqnorm(m1$residuals , main = "QQplot residuls" ,col = "#4B0082" )
qqline(m1$residuals , col = "red")
```

```{r}
jarque.test(m1$residuals)
```

```{r}
anscombe.test(m1$residuals)
```



